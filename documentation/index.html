--
layout: default
title: Documentation - sitespeed.io 3.0
description: Here's the documentation of how to use sitespeed.io 3.0.
keywords: documentation, web performance, sitespeed.io, graphite, navigation timing api
author: Peter Hedenskog
nav: documentation
image: http://www.sitespeed.io/img/sitespeed-2.0-twitter.png
twitterdescription: Documentation for the sitespeed.io 3.0.
---
 <div class="row">
    <div class="col-lg-12">
      <div class="page-header">
  <h1>
    Documentation version 3.0
  </h1>
  <p>
    Do you want the documentation for the 2.X version? You can find it <a href="/documentation-2.0/">here</a>.
  </p>
</div>
<div class="visible-xs">You need to use a larger screen to see the table of contents.</div>
<ul id="toc" class="hidden-xs">
  <li class="toc"><a href="#introduction">Introduction</a></li>
  <li class="toc"><a href="#installation">Download and installation</a></li>
  <ul>
  <li class="toc"><a href="#vagrant">Vagrant boxes</a></li>
  </ul>
    <li class="toc"><a href="#configuration">Configuration</a>
    <ul>
      <li class="toc"><a href="#theoptions">The options</a></li>
      <li class="toc"><a href="#basic">The basics</a></li>
      <ul>
        <li class="toc"><a href="#analyzebycrawling">Analyze by crawling</a></li>
        <li class="toc"><a href="#analyzebyurls">Analyze by URL:s</a></li>
        <li class="toc"><a href="#analyzesites">Analyze sites and benchmark</a></li>
        <li class="toc"><a href="#includeexclude">Include/exclude URL:s when crawling</a></li>
        <li class="toc"><a href="#screenshots">Screenshots</a></li>
        <li class="toc"><a href="#profiles">Profiles: test as desktop or mobile</a></li>
        <li class="toc"><a href="#mobile">Setting explicit viewport/user agent & mobile</a></li>
        <li class="toc"><a href="#limitpages">Limit pages to test</a></li>
        <li class="toc"><a href="#browsertimemetrics">Collect timing metrics</a></li>
        <li class="toc"><a href="#connectionspeed">Throttle the connection</a></li>
      </ul>
      <li class="toc"><a href="#nerdy">A little more nerdy</a>
        <ul>
        <li class="toc"><a href="#gpsi">Fetch data Google Page Speed Insights</a></li>
        <li class="toc"><a href="#wpt">Fetch data from WebPageTest</a></li>
        <li class="toc"><a href="#graphite">Send your data to Graphite</a></li>
        <li class="toc"><a href="#requestHeaders">Set request headers</a></li>
        <li class="toc"><a href="#config-boxes">Configure boxes on summary page</a></li>
        <li class="toc"><a href="#config-columns">Configure columns on pages page</a></li>
      </ul>
    </ul>
   <li class="toc"><a href="#browsertime">Fetching browser timings</a></li>
   <li class="toc"><a href="#usingwpt">Using WebPageTest</a></li>
   <ul>
     <li class="toc"><a href="#wptconfig">Configuration</a></li>
   </ul>
   <li class="toc"><a href="#usinggpsi">Using Google Page Speed Insights</a></li>
   <li class="toc"><a href="#phantomjs">Using PhantomJS 2</a></li>
   <li class="toc"><a href="#continuousintegration">Continuous integration</a></li>
  <ul>
     <li class="toc"><a href="#junitandTAP">JUnit and TAP</a></li>
     <li class="toc"><a href="#configurelimits">Configure when to break a test</a></li>
     <li class="toc"><a href="#skiptests">Skip rule tests</a></li>
     <li class="toc"><a href="#headless">Fetching timings headless</a></li>
     <li class="toc"><a href="#jenkins">Jenkins</a></li>
  <li class="toc"><a href="#travis">Travis</a></li>
  <li class="toc"><a href="#grunt">Grunt</a></li>

</ul>
  <li class="toc"><a href="#graphite-full">Graphite</a></li>

<li class="toc">Metrics</li>
<ul>
  <li class="toc"><a href="#timingMetrics">Timing metrics</a></li>
  <li class="toc"><a href="#timingMetricsWPT">Timing metrics from WebPageTest</a></li>
</ul>

    <li class="toc">Use cases
<ul>
      <li class="toc"><a href="#oneSite">Crawl and test one site</a></li>
      <li class="toc"><a href="#specificUrls">Test specific URL:s for one site</a></li>
      <li class="toc"><a href="#compareAndBench">Compare and benchmark your site against other sites</a></li>
      <li class="toc"><a href="#budget">Performance budget</a></li>
  </ul>



 <li class="toc"><a href="#developers">Developers</a></li>
  <ul>
  <li class="toc"><a href="#postTasks">Add your own post tasks</a></li>
  <li class="toc"><a href="#addRules">Add your own rules</a></li>
  <li class="toc"><a href="#dependencies">Dependencies</a></li>
     <li class="toc"><a href="#components">Components</a></li>
     <li class="toc"><a href="#feature">Create a new feature request</a></li>
     <li class="toc"><a href="#bug">Report a bug</a></li>
   </ul>
 </ul>


 <div class="section" id="introduction">
  <div class="page-header">
      <h1>Introduction</h1>
    </div>
    <p>Sitespeed.io is an open source tool that helps you understand if your site is fast or not. It tests
      your site against web performance best practice rules, get timings using Chrome/Firefox or PhantomJS 2 (using the Navigation Timing API and User Timing API).
    </p><p>
      You can also drive <a href="http://www.webpagetest.org/">WebPageTest</a> using sitespeed.io, collecting data from
      multiple URL:s tested using WebPageTest.
    </p>
      Sitespeed.io outputs the information as HTML/JSON or JUnit XML or <a href="http://testanything.org/">TAP</a>. And can automatically send the collected metrics to <a href="http://graphite.wikidot.com/">Graphite</a>.
    </p>
 </div>
<div class="section" id="installation">

      <div class="page-header">

      <h1>Download and installation</h1>
    </div>
    <h3>Install on Mac, Linux & Windows</h3>
        <p>Prerequisites: Install <a href="http://nodejs.org/download/">NodeJS</a> (<a href="https://github.com/creationix/nvm">Linux</a>) and make sure you have <a href="https://github.com/npm/npm">npm</a> installed.</p>
<pre class="bash">
$ npm install sitespeed.io
</pre>

<p>
If you want it installed globally (running it from wherever):
</p>
<pre class="bash">
$ npm install -g sitespeed.io
</pre>

        <p>Run</p>
        <pre class="bash">$ sitespeed.io -h</pre>
        <p>or on Windows:</p>
        <pre class="bash">$ sitespeed.io.cmd -h</pre>
<p>
  If you need help to get everything up and running, check the <a href="#vagrant">Vagrant</a> boxes.
</p>

</div>

<div class="section" id="vagrant">

  <div class="page-header">

    <h1>Vagrant</h1>
  </div>
    <p>We have a couple of <a href="https://github.com/sitespeedio/sitespeed.io-vagrant">Vagrant boxes</a> to get you up and running fast (installing sitespeed.io and browsers).</p>
    <ul>
      <li><a href="https://github.com/sitespeedio/sitespeed.io-vagrant/tree/master/sitespeed-ubuntu14">Ubuntu 14</a></li>
      <li><a href="https://github.com/sitespeedio/sitespeed.io-vagrant/tree/master/sitespeed-centos7">CentOS 7</a></li>
    </ul>
</div>

<div class="section" id="configuration">

      <div class="page-header">
      <h2>Configuration</h2>
    </div>
    <p>Sitespeed.io is highly configurable, let's check it out!</p>
  </div>

<div class="section" id="theoptions">

      <div class="page-header">
      <h2>The options</h2>
    </div>

<p>You have the following options running sitespeed.io:</p>
<pre>
Usage: node sitespeed.js [options]

Options:
-u &lt;URL&gt;, --url &lt;URL&gt;                                  The start url that will be used when crawling.
-f &lt;FILE&gt;, --file &lt;FILE&gt;                               The path to a plain text file with one URL on each row. Each URL will be analyzed.
--sites &lt;FILE&gt;                                         The path to a plain text file with one URL on each row. Each URL is crawled.
-V, --version                                          Display the sitespeed.io version.
-d &lt;INTEGER&gt;, --deep &lt;INTEGER&gt;                         How deep to crawl.  [1]
-c &lt;KEYWORD&gt;, --containInPath &lt;KEYWORD&gt;                Only crawl URLs that contains this in the path.
-s &lt;KEYWORD&gt;, --skip &lt;KEYWORD&gt;                         Do not crawl pages that contains this in the path.
-t &lt;NOOFTHREADS&gt;, --threads &lt;NOOFTHREADS&gt;              The number of threads/processes that will analyze pages.  [5]
--name &lt;NAME&gt;                                          Give your test a name, it will be added to all HTML pages.
--memory &lt;INTEGER&gt;                                     How much memory the Java processed will have (in mb).  [1024]
-r &lt;DIR&gt;, --resultBaseDir &lt;DIR&gt;                        The result base directory, the base dir where the result ends up.  [sitespeed-result]
--outputFolderName                                     Default the folder name is a date of format yyyy-mm-dd-HH-MM-ss
--userAgent &lt;USER-AGENT&gt;                               The full User Agent string, default is Chrome for MacOSX. [userAgent|ipad|iphone].  [Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.120 Safari/537.36]
--viewPort &lt;WidthxHeight&gt;                              The view port, the page viewport size WidthxHeight like 400x300.  [1280x800]
-y &lt;FILE&gt;, --yslow &lt;FILE&gt;                              The compiled YSlow file. Use this if you have your own rules.  [phantomjs/yslow-3.1.8-sitespeed.js]
--ruleSet &lt;RULE-SET&gt;                                   Which ruleset to use.  [sitespeed.io-desktop]
--limitFile &lt;PATH&gt;                                     The path to the limit configuration file.
--basicAuth &lt;USERNAME:PASSWORD&gt;                        Basic auth user & password.
-b &lt;BROWSER&gt;, --browser &lt;BROWSER&gt;                      Choose which browser to use to collect timing data. Use multiple browsers in a comma separated list (firefox|chrome|phantomjs)
--connection                                           Limit the speed by simulating connection types. Choose between mobile3g,mobile3gfast,cable,native  [native]
--btConfig &lt;FILE&gt;                                      Additional BrowserTime JSON configuration as a file
--profile &lt;desktop|mobile&gt;                             Choose between testing for desktop or mobile. Testing for desktop will use desktop rules & user agents and vice verca.  [desktop]
-n &lt;NUMBEROFTIMES&gt;, --no &lt;NUMBEROFTIMES&gt;               The number of times you should test each URL when fetching timing metrics. Default is 3 times.  [3]
--screenshot                                           Take screenshots for each page (using the configured view port).
--junit                                                Create JUnit output to the console.
--tap                                                  Create TAP output to the console.
--skipTest &lt;ruleid1,ruleid2,...&gt;                       A comma separated list of rules to skip when generating JUnit/TAP output.
--testData                                             Choose which data to send test when generating TAP/JUnit output. Default is all available [rules,timings,wpt,gpsi]  [all]
--budget &lt;FILE&gt;                                        A file containing the web perf budget rules. See http://www.sitespeed.io/documentation/#budget
-m &lt;NUMBEROFPAGES&gt;, --maxPagesToTest &lt;NUMBEROFPAGES&gt;   The max number of pages to test. Default is no limit.
--storeJson                                            Store all collected data as JSON.
-p &lt;PROXY&gt;, --proxy &lt;PROXY&gt;                            http://proxy.soulgalore.com:80
--cdns &lt;cdn1.com,cdn.cdn2.net&gt;                         A comma separated list of additional CDNs.
--postTasksDir &lt;dir&gt;                                   The directory where you have your extra post tasks.
--boxes &lt;box1,box2&gt;                                    The boxes showed on site summary page, see http://www.sitespeed.io/documentation/#config-boxes
-c &lt;column1,column2&gt;, --columns &lt;column1,column2&gt;      The columns showed on detailed page summary table, see http://www.sitespeed.io/documentation/#config-columns
--configFile &lt;PATH&gt;                                    The path to a sitespeed.io config.json file, if it exists all other input parameters will be overidden.
--aggregators &lt;PATH&gt;                                   The path to a directory with extra aggregators.
--collectors &lt;PATH&gt;                                    The path to a directory with extra collectors.
--graphiteHost &lt;HOST&gt;                                  The Graphite host.
--graphitePort &lt;INTEGER&gt;                               The Graphite port.  [2003]
--graphiteNamespace &lt;NAMESPACE&gt;                        The namespace of the data sent to Graphite.  [sitespeed.io]
--graphiteData                                         Choose which data to send to Graphite by a comma separated list. Default all data is sent. [summary,rules,pagemetrics,timings]  [all]
--gpsiKey                                              Your Google API Key, configure it to also fetch data from Google Page Speed Insights.
--noYslow                                              Set to true to turn of collecting metrics using YSlow.
--html                                                 Create HTML reports. Default to true. Set no-html to disable HTML reports.  [true]
--wptConfig &lt;FILE&gt;                                     WebPageTest configuration, see https://github.com/marcelduran/webpagetest-api runTest method
--wptHost &lt;URL&gt;                                         The host domain of the webpagetest instance.
--wptKey &lt;KEY&gt;                                         The API key if running on webpagetest on the public instances.
--requestHeaders &lt;FILE&gt;                                Any request headers to use, a file with JSON form of {"name":"value","name2":"value"}. Not supported for WPT & GPSI.
   </pre>
   <p>
     Yep, that was a lot, we know. Lets go into some standard use cases.
   </p>

</div>


<div class="section" id="basic">
    <div class="page-header">
    <h2>The basics</h2>
  </div>

<p>If you installed with the global option (-g), run the command <em>sitespeed.io</em> else run the script <em>lib/sitespeed.js</em>.  In the examples we will use the script but you know what to do if you have it installed.</p>
  <p>You can analyze a site either by crawling or feed sitespeed.io with the URL:s you want to analyze.
</p>
</div>

<div class="section" id="analyzebycrawling">
    <div class="page-header">
    <h2>Analyze by crawling</h2>
</div>
<p>The crawler needs a start URL (the parameter <strong>u</strong>, from where it will start the crawl). It will fetch all links within the same domain as the URL that you provide. You can then choose how deep you want to crawl with the <strong>d</strong> parameter. Zero will fetch only the
  URL that you provide. One will fetch all links on that page and analyze these, two will go one level deeper and so on. If you want to analyze a site and the links with a depth of two, you do like this:
</p>
<pre class="bash">$ sitespeed.io -u http://www.yoursite.com -d 2</pre>

<div class="note note-info">Remember that you can start your crawl deep into your path structure like <strong style="word-wrap: break-word; white-space: normal;">http://yoursite.com/my/path</strong>.</div>
</div>


<div class="section" id="analyzebyurls">
    <div class="page-header">
    <h2>Analyze by URL:s</h2>
</div>
<p>Instead of giving a start URL for the crawl, you can supply a plain text file with one URL on each row. Then each of these URL will be analyzed, no more or no less. A file like this will do:</p>

<pre>
http://www.yoursite.com/path/
http://www.yoursite.com/my/really/important/page/
http://www.yoursite.com/where/we/are/
</pre>
<p>Then you feed the file to the script:</p>
<pre class="bash">$ sitespeed.io -f myurls.txt</pre>
<div class="note note-info">This is good for testing and keep tracks of your site in production and you have a LARGE site with many pages and a couple of them are more important than the rest. </div>
</div>

<div class="section" id="analyzesites">
    <div class="page-header">
    <h2>Analyze sites and benchmark</h2>
</div>
<p>If you want to test and benchmark sites you can do like this:</p>

<pre>
http://www.yoursite.com/path/
http://www.mycompetition.com/
http://www.mycompetition2.com/
</pre>
<p>Then you feed the file to the script and each URL will be crawled. You can run the crawl the exact same way as usual, by feeding parameters.</p>
<pre class="bash">$ sitespeed.io --sites mysitesurls.txt</pre>

<p>
   If you instead want to compare a couple of URL:s between sites (pre defined URLS instead of crawling), do like this:
   Create a master plain text file. Each row of this file points out another file that contains the specific URLs for that site.
   The master looks like this (master.txt):
   <pre>
theguardian.txt
nytimes.txt
...
   </pre>
   Then create the specific files (theguardian.txt):
   <pre>
http://www.theguardian.com/uk
http://www.theguardian.com/uk/sport
http://www.theguardian.com/uk/culture
   </pre>
   And nytimes.txt:
   <pre>
http://www.nytimes.com/
http://www.nytimes.com/pages/sports/index.html
http://www.nytimes.com/pages/fashion/index.html
   </pre>
   You can of course add how many URL:s and sites you want.
   Then you run the whole thing like this:
<pre class="bash">$ sitespeed.io --sites master.txt</pre>
  Checkout the Graphite section to see how you can graph the runs nicely.

</p>

</div>

<div class="section" id="includeexclude">
    <div class="page-header">
    <h2>Include/exclude URL:s when crawling</h2>
</div>
<p>You want to make sure that parts of your site isn't included in your analyze, then you can add the parameter <strong>s</strong> and a keyword. Every URL with that keyword will not be included.</p>
 <pre class="bash">$./bin/sitespeed.io -u http://yoursite.com  -s /monkey/</pre>
<p>You can also do it the other way around, with the <strong>c</strong> and a keyword. In this case, the analyze will only include URL:s with the keyword.</p>
<pre class="bash">$  ./bin/sitespeed.io -u http://yoursite.com  -c /the/path/</pre>
</div>

<div class="section" id="screenshots">
    <div class="page-header">
 <h2>Screenshots</h2>
</div>
<p>You can get screenshots of every page that you analyze. These will end up on a screenshot page where you can check them all. The screenshots will be taken for the chosen viewport.
</p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  --screenshot</pre>
</div>

<div class="section" id="profiles">
    <div class="page-header">
 <h2>Shortcut: test as desktop or mobile</h2>
</div>
<p>By default you test as desktop, if you turn on mobile by just setting the profile. If you do that, you will automatically test with
mobile rules, an IOS user agent, view port of 320x444 and on a throttled connection simulating a mobile 3g connection.</p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  --profile desktop</pre>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  --profile mobile</pre>
</div>

<div class="section" id="mobile">
    <div class="page-header">
 <h2>Viewport/user agent and mobile</h2>
</div>
<p>You can set the viewport & user agent, so that you can fake testing a site as a mobile device.</p>

<p>By default the viewport is 1280x800 with the following user agent for Chrome on MacOSX.</p>

<pre class="bash">$ sitespeed.io -u http://yoursite.com  --viewPort 400x300 --userAgent "My SUPER BROWSER"</pre>

<div class="note note-warning">
Mobile testing is always best on mobile devices. For tips on how to best do that, read Andy Davies <a href="http://andydavies.me/" >blog</a>.
</div>
</div>

<div class="section" id="limitpages">
    <div class="page-header">
 <h2>Limit pages to test</h2>
</div>
<p>Sometimes you want to limit the amount to test (I do that when I compare sites). That will test maximum the amount of pages you supply.</p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  -m 10</pre>
</div>

<div class="section" id="name">
    <div class="page-header">
 <h2>Set a name of your test</h2>
</div>
    <p>You can give your test run a name that will be showed on all the pages.</p>
    <pre class="bash">$ sitespeed.io -u http://yoursite.com/ --name "Swedens top 100 sites"</pre>
</div>

<div class="section" id="browsertimemetrics">
    <div class="page-header">
 <h2>Collect timing metrics</h2>
</div>
<p>Sitespeed.io collect timing metrics using the Navigation Timing API and the User Timing API. Today you can use
Chrome, Firefox and PhantomJS 2.0. We also have exprimental support for Internet Explorer (ie) and Safari.</p>

<p>Add the parameter <em>b</em> followed by the browser name. </p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  -b firefox</pre>

<p>Each page is tested 3 times by default. You can change that with the <em>n</em> parameter.  Test using  Chrome and test each page 9 times, looks like this:</p>

<pre class="bash">$ sitespeed.io -u http://yoursite.com  -b chrome -n 9</pre>

<p>If you want to test in multiple browsers, you add them in a comma separated list:</p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  -b firefox,chrome -n 7</pre>

<div class="section" id="connectionspeed">
    <div class="page-header">
 <h2>Throttle the connection</h2>
</div>
<p>
  You can throttle the connection when you are fetching metrics using the browser. Choose between:
  <ul>
    <li><strong>mobile3g</strong> - 1.6 Mbps/768 Kbps - 300 RTT</li>
    <li><strong>mobile3gfast</strong> - 1.6 Mbps/768 Kbps - 150 RTT</li>
    <li><strong>cable</strong> - 5 Mbps/1 Mbps - 28 RTT</li>
    <li><strong>native</strong> - the current connection</li>
  </ul>
  And do like this:
</p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com -b chrome --connection mobile3g</pre>

</div>


<div class="section" id="gpsi">
    <div class="page-header">
 <h2>Fetch data Google Page Speed Insights</h2>
</div>
<p>
  To test each page using GPSI, you need to have a a Google API Key. You can get one <a href="https://console.developers.google.com/project">here</a>. Testing using GPSI will
  include the GPSI score in the summary page and all individual data on the detailed page.
</p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  --gpsiKey MY_SECRET_KEY</pre>

</div>

<div class="section" id="wpt">
    <div class="page-header">
 <h2>Fetch data from WebPageTest</h2>
</div>

<p>Yep, it is true! You can drive WebPageTest from sitespeed.io. You need to either have your own private instance or an API key.
</p>
<pre class="bash">$ sitespeed.io -u http://yoursite.com  --wptHost www.webpagetest.org --wptKey MY_SECRET_API_KEY</pre>
<p>
  In the background Marcel Durans WPT API is used, specific the <a href="https://github.com/marcelduran/webpagetest-api#user-content-test-works-for-test-command-only">runTest</a> method.
  You can pass all the parameters in the runTest through sitespeed.io by the <strong>--wptConfig</strong> parameter and supply a JSON file.
</p>
<p>
  By default, the following values are passed to WPT:
<pre>
pollResults: 10,
timeout: 600,
firstViewOnly: false,
runs: // the number of runs you configure by the n parameter
private: true,
aftRenderingTime: true,
location: 'Dulles:Chrome',
video: true
</pre>
And if you configured basic auth, the login/password is also passed to WPT.
</p>
<p>
If you pass your own <strong>--wptConfig</strong>, a fields matching will override the default configuration.
</p>
</div>

<div class="section" id="graphite">
    <div class="page-header">
 <h2>Send your data to Graphite</h2>
</div>

<p>You can choose to send your data to Graphite, to keep track of your performance over time.
You configure four things: the host, port, the namespace and which data to send. Default value for the port is 2003, namespace (the start of the key) is sitespeed and send all collected data.</p>
</p>
<pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --graphiteHost localhost</pre>
</div>

<div class="section" id="requestHeaders">
    <div class="page-header">
 <h2>Set request headers</h2>
</div>
<p>The headers can be set if you collect rules and timings. It will not work for WPT and GPSI. Supply a JSON file like this:
  <pre>
{
  "mysupercoolheader":"value",
  "coolheader2":"value2"
}</pre>
And the run like this:
</p>

<pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --requestHeaders myheaders.txt</pre>
</div>

<div class="section" id="config-boxes">
    <div class="page-header">
 <h2>Configure boxes on summary page</h2>
</div>
<p>You can choose which boxes you want to show on the summary page by configure them by their name. You can choose to
  show to configure them exactly as you want. Then you need to pass every name to the script:
</p>
<pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --boxes thirdpartyversions,ycdn</pre>
<p>Or if you want to add boxes to the already pre-configured ones, you can add a plus sign before the name(it is perfect
  if you have your own User Timings that you want to show):
<pre class="bash">$ sitespeed.io -u http://www.sitespeed.io -b chrome --boxes +logoTime,headerTime</pre>
<p>These boxes will then end up in the end of the list.</p>
</div>

<div class="section" id="config-columns">
    <div class="page-header">
 <h2>Configure columns on pages page</h2>
 <p>You can choose what kind of data you want to show in the column pages.</p>
 <pre class="bash">$ sitespeed.io -u http://www.sitespeed.io -b chrome -c logoTime,headerTime</pre>
</div>

</div>

<div class="section" id="browsertime">
  <div class="page-header">
    <h2>Fetching browser timings</h2>
  </div>
  <p>You can fetch timings (Navigation Timing and User Timings) using real browsers using the <code>-b</code> flag. We use
    <a href="https://github.com/tobli/browsertime">BrowserTime</a> to collect the data. By a default
    installation you can fetch timings using Chrome and Firefox (as long as you have them installed on your machine).
  </p>
  <p>There's also prepared support for Safari and Internet Explorer (Windows only). To test them out,
    you need to run your start your own <a href="http://www.seleniumhq.org/download/">Selenium server</a>. By default
    sitespeed.io will try to reach it at <code>http://localhost:4444/wd/hub</code>.
    </p>
    <p>
  To get Safari to work, you need to install the <a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/safari-driver">SafariDriver extension</a> in the browser. We haven't
  tested this yet, please help us out and update the doc on how to do it.
  </p>
  <p>To get Internet Explorer to work, follow the <a href="https://code.google.com/p/selenium/wiki/InternetExplorerDriver#Required_Configuration">instructions</a>.
  </p>

  <div class="note note-warning">
    There's a problem using sitespeed.io/BrowserTime on Windows, where the BrowserMobProxy isn't closed/killed between runs, you need to kill it yourself right now.
  </div>

</div>

<div class="section" id="usingwpt">
       <div class="page-header">
      <h2>Using WebPageTest</h2>
    </div>
    <p>Yep we all love <a href="http://www.webpagetest.org">WebPageTest</a> (WPT), so we made it possible to drive an instance of and collect the data from it.
    </p>
    <p>
    To use WPT you can either get an <a href="http://www.webpagetest.org/getkey.php">API key</a> (sponsored by Akamai) for the global version
    or follow Pat Meenans instructions on <a href="http://calendar.perfplanet.com/2014/webpagetest-private-instances-in-five-minutes/">how to get a private version up and running in 5 minutes</a>.
    </p>

    <p>
    Out of the it will collect <a href="https://github.com/sitespeedio/sitespeed.io/tree/master/lib/aggregators/webpagetest">these</a> metrics
    that can be displayed on the summary page. By default, these will be shown:</p>


    <p class="text-center">
      <a href="wpt-summary.png"><img src="wpt-summary.png" alt="" class="img-thumbnail"/></a>
    </p>
    <p>
      On the pages summary, you will also automatically get the SpeedIndex score:
    </p>

    <p class="text-center">
      <a href="wpt-pages.png"><img src="wpt-pages.png" alt="" class="img-thumbnail"/></a>
    </p>

    <p>
      And on the detailed summary page, we show some interesting metrics and the waterfalls
      for the median result of both first and repeated view:
    </p>

    <p class="text-center">
      <a href="wpt-detailed-page-info.png"><img src="wpt-detailed-page-info.png" alt="" class="img-thumbnail"/></a>
    </p>

    <div class="page-header">
    <h2 id="wptconfig">Configuration</h2>
    </div>
    <p>There is some default configuration that is passed to WebPageTest. It looks like this:
<pre>
{
  pollResults: 10,
  timeout: 600,
  firstViewOnly: false,
  runs: n, // the number of times passed by -n, default 3
  private: true,
  aftRenderingTime: true,
  location: 'Dulles:Chrome',
  video: true
}</pre>
And if basic auth is set, it is passed as basic auth.</p>
<p>
  In the background the test method in Marcel Durans webpagetest-api is used, so you can configure almost everything. Checkout the docs <a href="https://github.com/marcelduran/webpagetest-api#user-content-test-works-for-test-command-only">here</a>.
  You configure your own stuff by feeding sitespeed.io with a JSON file. Say you want to test form Dulles using a throttled 3G connection:
<pre>
{
  "location": "Dulles:Firefox",
  "connectivity": "3G"
}</pre>
The default location will be overidden and the connectivity will be set to 3G.
Feed it with: <code>--wptConfig yourFile.json</code>
</p>

<div class="page-header">
<h2>Graph the WPT metrics</h2>
</div>
<p>
  The data collected and showed can also be sent to Graphite. Checkout the Graphite <a href="#graphite-full">section</a>.
</p>

</div>

<div class="page-header">
  <h2>WPT performance budget</h2>
</div>
<p>
  The timings and metrics collected by WebPageTest can also be used in you performance budget. More info <a href="#budget">here</a>.
</p>

</div>


<div class="section" id="usinggpsi">
       <div class="page-header">
      <h2>Using Google Page Speed Insights</h2>
    </div>
    <p>Google Page Speed Insights (GPSI) is Google:s rule/best practices rules to build a web site that are as fast as possible.
      Follow the rules and your site will be fast.</p>
    <p>
      Sitespeed.io integrates GPSI so you can fetch how good your site is doing. Two things: Your site needs to reachable from the internet (and no basic authentication) and
      you need to supply your own <a href="https://console.developers.google.com/project">Google key</a>.</p>
      <p>
          Run it like this:
          <pre class="bash">$ sitespeed.io -u http://yoursite.com  --gpsiKey MY_SECRET_KEY</pre>
      </p>
      <p>
        Sitespeed.io will collect all available data from GPSI. On the summary page,
        the GPSI score will be shown. We also collect number of requests. You can check the implementation
        <a href="https://github.com/sitespeedio/sitespeed.io/tree/master/lib/aggregators/gpsi">here</a> and add
        an issue if you want us to collect more data:</p>
        <p class="text-center">
          <a href="gpsi-summary.png"><img src="gpsi-summary.png" alt="" class="img-thumbnail"/></a>
        </p>
        <p>
          On the pages summary, you will also automatically the GPSI score:
        </p>

        <p class="text-center">
          <a href="gpsi-pages.png"><img src="gpsi-pages.png" alt="" class="img-thumbnail"/></a>
        </p>

        <p>
          And on the detailed summary page, we show all the data that are provided by GPSI, it
          looks like this:
        </p>

        <p class="text-center">
          <a href="gpsi-detailed-page-info.png"><img src="gpsi-detailed-page-info.png" alt="" class="img-thumbnail"/></a>
        </p>

</div>

<div class="section" id="phantomjs">
       <div class="page-header">
      <h2>PhantomsJS 2</h2>
    </div>
    <p><a href="http://phantomjs.org/">PhantomJS</a> is used by default when validating the web performance best practice rules. Soon (!) the 2.0 version will be released of Phantom and the new version
    is much (yep much) faster than the old version and supports (most of) the Navigation Timing API, meaning you can test the speed of your site. It's always better to use a real browser when collecting timings, but it is cool because PhantomJS 2 is so fast so you can test alot of pages/sites. The 2.0 has not a stable release yet, but you can build it yourself and use it when you run sitespeed.io:</p>
    <p>
      <ol>
        <li>Follow <a href="https://github.com/ariya/phantomjs/wiki/PhantomJS-2">these</a> instructions to build PhantomJS 2.</li>
        <li>Run sitespeed.io and configure it to use your own version of PhantomJS:
        <pre class="bash">sitespeed.io -u http://www.sitespeed.io --phantomjsPath /the/path/to/your/bin</pre>
        </li>
        <li>If you also want to collect timings using PhantomJS, run it like this:
          <pre class="bash">sitespeed.io -u http://www.sitespeed.io --phantomjsPath /the/path/to/your/bin -b phantomjs</pre>
        </li>
      </ol>
    </p>
    <div class="note note-warning">
      We have tested PhantomJS 2 on Mac OS X and it works really good when testing the site against the best practice rules. However, it seems
      to be a couple of timings that don't work as expected. If you have time to test and find things that don't work, please
      let us know and we will update the docs. We aim to give this more love when the stable 2.0 is released.
    </div>
</div>


<div class="section" id="continuousintegration">
       <div class="page-header">
      <h2>Continuous integration</h2>
    </div>
    <p>Use sitespeed.io to keep track of what is happening with your site and make sure you know that you don't break the performance best practice rules <em>before</em> your changes are released.
      Your build can also be broken if your page timings (choose whatever timing you need from the Navigation Timing API or your own custom timing) break your limits. And of course, if you use WebPageTest or
      Google Page Speed Insights, you can use the metrics from them to break your build.
    </p>
    <p>
      Sitespeed.io outputs <a href="http://help.catchsoftware.com/display/ET/JUnit+Format">JUnit XML</a> and <a href="http://testanything.org/">TAP</a> that test your metrics against your configured limits.
    </p>

 </div>
<div class="section" id="junitandTAP">
 <div class="page-header">
      <h2>Generating JUnit XML or TAP</h2>
    </div>
       <p>Sitespeed can output <em>junit.xml</em> that works perfect with your continuous integration tool. Jenkins, Bamboo and others support it out of the box.</p>
       <pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --junit</pre>
       <p>And if you rather prefer TAP:</p>
       <pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --tap</pre>

</div>

<div class="section" id="configurelimits">
 <div class="page-header">
      <h2>Configure when to break a test</h2>
    </div>
    <p>By default these are the values that are tested:</p>
    <pre>
{
  "rules": {
    "default": 90
  },
  "timings": {
    "serverResponseTime": 300,
    "domContentLoadedTime": 700,
    "speedIndex": 1000
  },
  "wpt": {
    "SpeedIndex": 1000
  },
  "gpsi": {
    "score": 90
  }
}</pre>
<p>This means that all rules must be 90 or better,serverResponseTime 300 ms or better,
domContentLoadedTime to be faster than 700 ms. If you use WebPageTest, the speed index need to be under 1000.
And finally, if you use Goggle Page Speed Insights, the score must be 90 or better.</p>

<p>
  You can configure to point out a JSON file containing all the values:
</p>
    <pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --tap --budget myBudget.json</pre>
</div>
<div class="section" id="skiptests">
 <div class="page-header">
      <h2>Skip rule tests</h2>
    </div>
    <p>
      By default a all rules is tested against the default number you specify, meaning all rules needs to be 90 or better.
      Sometimes you have some rules you don't care about and can skip. You do that
      by feeding the rule names to the script. You find all the names <a href="/rules/">here</a>.

      <pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --skipTest ycdn,textcontent --tap</pre>
    </p>
</div>

<div class="section" id="headless">
    <div class="page-header">
 <h2>Fetching timings headless</h2>
</div>
  <p>Fetching timings using PhantomJS 2.0 is headless by default. If you run on Linux and want to emulate a screen (a.k.a running a browser without a screen), you need to do this before running:</p>
  <ul>
  <li>Install <a href="http://www.x.org/releases/current/doc/man/man1/Xvfb.1.xhtml" >XVFB</a>.</li>
  <li>Setup a start script, something like <a href="https://gist.github.com/jterrace/2911875" >this</a>.</li>
  <li>Export the display, make sure to have the same number as in the examle in the Gist: <em>export DISPLAY=:99.0</em></li>
  <li>Start Xvfb: <em>sh -e /etc/init.d/xvfb start</em></li>
</ul>
</div>


<div class="section">
      <h2 id="jenkins">Jenkins</h2>
       <p>You may love or you may hate <a href="http://jenkins-ci.org/">Jenkins</a>, we think it is a great open source continuous integration server.
  And to get sitespeed.io up and running is easy. And combine it with Graphite will add some super power.
  </p>
  <p>
    <ol>
      <li>
        Choose <strong>New Item</strong> and create a new freestyle project.
      </li>
      <li>
        Choose <strong>Add build step</strong> in the Build part and <strong>Execute shell</strong> you will have a box where you add your sitespeed.io CLI magic. Remember that the
        Jenkins user needs to have nodejs in the path. It can look like this (sending the data to a local Graphite instance):
        <pre>sitespeed.io -u http://www.cybercom.com --graphiteHost localhost --graphiteNamespace cybercom-production -b chrome -n 11</pre>
      </li>
    </ol>
    <ol>
      <li>
        If you want to break your build, you can either generate JUnit XML and use the built in
        post task <strong>Publish JUnit test result report</strong>.
      </li>
      <li>
        In the execute shell form:
        <pre>sitespeed.io -u http://stage.cybercom.com --junit > $WORKSPACE/junit.xml</pre>
        And in the post task <strong>Test report XMLs</strong> add:
        <pre>junit.xml</pre>
      </li>
      <li>
        Using TAP, you need to install the <a href="https://wiki.jenkins-ci.org/display/JENKINS/TAP+Plugin">TAP plugin</a>
      </li>

      <li>Run the execute shell like this:
        <pre>sitespeed.io -u http://stage.cybercom.com --tap > $WORKSPACE/sitespeed.tap</pre>
      </li>
      <li>
        And choose the post task <strong>Publish TAP Results</strong> and in the Test Results box add:
        <pre>sitespeed.tap</pre>
      </li>
    </ol>
  </p>

  <p>
    If you want the browsers to run headless, use the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Xvfb+Plugin">Xvfb plugin</a>.
  </p>

  </div>

<div class="section" id="travis">
      <h2>Travis integration</h2>
      <p>Coming soon!</p>
</div>

<div class="section" id="grunt">
      <h2>Grunt integration</h2>
      <p>Coming soon!</p>
</div>

<div class="section" id="graphite-full">
    <div class="page-header">
 <h2>Graphite</h2>
</div>
  <p>The easiest way to graph your data (and keep track how you are doing over time), is sending the data to <a href="http://graphite.wikidot.com/">Graphite</a>. And then
    use a tool to create the graphs. I like <a href="http://grafana.org/">Grafana</a>, because it is super simple and look nice. Here's how you do it:
  </p>
  <ul>
    <li>
      Install Graphite - if you are on Mac OS X and want to test it out, use a Vagrant setup.
    </li>
    <li>
      Install Grafana - either by Vagrant or just download and install InfluxDb & ElasticSearch
    </li>
    <li>
      Send the data from sitespeed.io to Graphite
    </li>
    <li>
      Create the graphs in Grafana. We will soonish add a video of how to do it.
    </li>
  </ul>

  <p>
      Here are a couple of examples of what ut can look like. Here we test one site, something like this:
<pre class="bash">sitespeed.io -u http://www.cybercom.com --graphiteHost localhost -m 5 --graphiteNamespace cybercom -b chrome -n 11</pre>

And setup the following graphs:
<p class="text-center">
  <a href="grafana-page-metrics.png"><img src="grafana-page-metrics.png" alt="sitespeed.io page metrics sent to Graphite" class="img-thumbnail"/></a>
</p>
<p class="text-center">
  <a href="grafana-timing-metrics.png"><img src="grafana-timing-metrics.png" alt="sitespeed.io timing metrics sent to Graphite" class="img-thumbnail"/></a>
</p>

  </p>

<p>
  In this example, we compare four Swedish newspapers, running it like this
  <pre class="bash">$ sitespeed.io  --sites /Users/peter/swedish.txt --graphiteHost localhost --graphiteNamespace newspapers -b chrome -n 7</pre>
and the result:
<p class="text-center">
  <a href="grafana-swedish-newspapers.png"><img src="grafana-swedish-newspapers.png" alt="sitespeed.io comparing multiple sites" class="img-thumbnail"/></a>
</p>
</p>

<p>
  And the last example, we fetch data from WebPageTest and create the following:
  <p class="text-center">
    <a href="grafana-wpt-dark.png"><img src="grafana-wpt-dark.png" alt="sitespeed.io running WebPageTest and graphing the data" class="img-thumbnail"/></a>
  </p>
</p>


<div class="note note-info">If you send all the metrics and don't need the other output (HTML/JSON, it can be quite extensive if you run it often), put all the output in <em>/tmp</em> with the <em>r</em> switch like this <code>-r /tmp</code>.</div>
</div>

<div class="note note-warning">
  Doesn't all values reach Graphite (are you missing values), then you should check your <strong>carbon.conf</strong> file.
  The configuration <strong>MAX_CREATES_PER_MINUTE</strong> needs to be set to high (we have seen that 50 is too low). To make sure it works, set it like this:
  <pre>MAX_CREATES_PER_MINUTE = inf</pre>
</div>

</div>

<div class="section">
      <div class="page-header">
      <h2 id="timingMetrics">Timing metrics</h2>
    </div>
    <p>
      All the metrics are collected using an empty cache.</p>
    <ul>
      <li><em>backEndTime</em> - The time it takes for the network and the server to generate and start sending the HTML. Definition: responseStart - navigationStart</li>
      <li><em>domContentLoadedTime</em> - The time the browser takes to parse the document and execute deferred and parser-inserted scripts including the network time from the users location to your server. Definition: domContentLoadedEventStart - navigationStart</li>
      <li><em>domInteractiveTime</em> - The time the browser takes to parse the document, including the network time from the users location to your server. Definition: domInteractive - navigationStart</li>
      <li><em>domainLookupTime</em> - The time it takes to do the DNS lookup. Definition: domainLookupEnd - domainLookupStart</li>
      <li><em>frontEndTime</em> - The time it takes for the browser to parse and create the page. Definition: loadEventStart - responseEnd</li>
      <li><em>pageDownloadTime</em> - How long time does it take to download the page (the HTML). Definition: responseEnd - responseStart</li>
      <li><em>pageLoadTime</em> - The time it takes for page to load, from initiation of the page view (e.g., click on a page link) to load completion in the browser. Important: this is only relevant to some pages, depending on how you page is built. Definition: loadEventStart - navigationStart</li>
      <li><em>redirectionTime</em> - Time spent on redirects. Definition: fetchStart - navigationStart</li>
      <li><em>serverConnectionTime</em> - How long time it takes to connect to the server. Definition: connectEnd - connectStart</li>
      <li><em>firstPaint</em> - This is when the first paint happens on the screen. If the browser support this metric, we use that. Else we use the time of the last non-async script or css from the head. You can easily verify if the first paint metrics is valid for you, by record a video using WebPageTest, and then check exactly when the first paint happens and compare that with the timing from the browser.</li>
      <li> <a href="https://github.com/WPO-Foundation/RUM-SpeedIndex">RUM-SpeedIndex</a> - created by Pat Meenan
        and calculate SpeedIndex measurements using Resource Timings. It iss not as perfect as Speed Index in WPT but a good start.</li>
    </ul>
    </div>

<div class="section">
      <div class="page-header">
      <h2 id="timingMetricsWPT">Timing metrics collected using WPT</h2>
    </div>
    <p>
      All the metrics are collected both for first and repeated view.</p>
    <ul>
      <li><em>firstPaint</em> - the time from the start of navigation until the first non-white content was painted to the screen</li>
      <li><em>loadTime</em> - the time from the start of the initial navigation until the beginning of the window load event (onload).</li>
      <li><em>TTFB</em> - the time from the start of navigation until the first byte of the base page is returned (after following any redirects)</li>
      <li><em>SpeedIndex</em> - is the average time at which visible parts of the page are displayed. It is expressed in milliseconds and dependent on size of the view port. You need to <a href="https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/metrics/speed-index">read more</a> to fully understand how it works.</li>
      <li><em>VisualComplete</em></li>
    </ul>
</div>

<div class="section">
  <div class="page-header">
    <h2 id="oneSite">Crawl and test one site</h2>
  </div>
  <p>
    One of the most common use case is to crawl a site and analyze and measure the URL:s.
    Crawling a site is good because it will find new pages that are linked for the pages you crawl.
  </p>
  <p>
    I use this for sites where the
    content team creates new pages directly in the CMS and I as developer are out of control of
    which pages that exist. Crawling will make sure we pick up new pages and measure them.
    I usually use this in production to pick up pages that could/should be faster.
  </p>
  <p>
    Crawling too deep can take long time. One way to handle that is to test specific
    sections one at a time. Say we want to test sport pages for New York Times:
    <pre class="bash">
sitespeed.io -u http://www.nytimes.com/pages/sports/ -c /sports/ -d 2</pre>
  Will make sure we only pick up pages under /sports/.
  </p>
</div>

<div class="section">
  <div class="page-header">
    <h2 id="specificUrls">Test specific URL:s for one site</h2>
  </div>
  <p>
    Testing the same URL over and over again is good so you can benchmark it. I use it
    in my continuous integration tool (to check the performance before changes is released) and
    when I compare sites to its competitors (matching start pages, product pages, purchase flows etc).
  </p>
  <h3>How do I choose which URL:s to test?</h3>
  <p>I usually use Google Analytics to check which are the most pages or talk to the business to check that we have
  the same understanding of which pages are the most important of our site. If we going to test the URL:s
  in our continuous integration, I try to keep the list of URL:s small, max 10, so we can test
  each URL many times to get timings that consistent between runs.</p>
  <h3>Setup</h3>
  <p>
    I create a text file named amazon.txt with all the URL:s
<pre>
http://www.amazon.com/
http://www.amazon.com/gp/site-directory/
http://www.amazon.com/dp/B00I15SB16/ref=ods_gw_comb_xmas_kindle
</pre>
And run it like this
<pre class="bash">sitespeed.io -f amazon.txt -b chrome -n 11</pre>
  </p>

</div>

<div class="section">
  <div class="page-header">
    <h2 id="compareAndBench">Compare and benchmark your site against other sites</h2>
  </div>
  <p>
  Comparing your site against competitors is often very interesting. I usually use it to compare how fast pages are loaded
  and also how the pages are built (how many requests, how much javascript etc).
  </p>
    <h3>Setup the files</h3>
    <p>
      I create one file containing the urls for each site that I want to test. Testing
      amazon.com I create file named apple.txt with the URL:s I want to test:
<pre>
http://www.apple.com/
http://www.apple.com/iphone/
http://www.apple.com/iphone-6/
</pre>
and I compare it to Sony Mobile. I create a new text file named sony.txt with the following content:
<pre>
http://www.sonymobile.com/se/
http://www.sonymobile.com/se/products/phones/
http://www.sonymobile.com/se/products/phones/xperia-z3-compact/
</pre>
And then I create a master file linking in the other two files:
<pre>
apple.txt
sony.txt
</pre>
    </p>
    <h3>Run the test</h3>
    <p>
      Then I run it like this:
<pre class="bash">sitespeed.io --sites master.txt</pre>
Of course you can add all the parameters as usual to sitespeed, testing your site using
chrome, test 11 times and also test with WebPageTest and Google Page Speed Insights and sending the data to Graphite looks like this:
<pre class="bash">sitespeed.io --sites master.txt -b chrome -n 11 --wptHost your.webpagetest.com --gpsiKey YOUR_GOOGLE_KEY --graphiteHost mygraphitehost.com</pre>
</p>
</div>

<div class="section">
  <div class="page-header">
    <h2 id="budget">Performance budget</h2>
  </div>
  <p>
    Have you heard of a performance budget? If not, please read the excellent posts by Tim Kadlec:
    <a href="http://timkadlec.com/2013/01/setting-a-performance-budget/">Setting a performance budget</a> and <a href="http://timkadlec.com/2014/01/fast-enough/">Fast enough</a>. Also read Daniel Malls
    <a href="http://danielmall.com/articles/how-to-make-a-performance-budget/">How to make a performance budget</a>. After that, continue setup sitespeed.io :)
  </p>

  <h3>Testing timings</h3>
  <p>
    If you have a budget where you want to test the (RUM) speed index, you add a file like this:
    <pre>
{
  "timings": {
    "speedIndex": 1000
  }
}</pre>
Then run it like this:
<pre class="bash">$ sitespeed.io -u http://www.sitespeed.io --budget myBudget.json -b chrome -n 11</pre>

      You can test all timings produced by BrowserTime like <em>domContentLoadedTime</em>
      or <em>backEndTime</em>.
    </p>

    <h3>Testing user timings</h3>
    <p>
      You can have a budget for your own User Timings metrics. For www.sitespeed.io we have
      two user timing metrics: <em>logoTime</em> and <em>headerTime</em>. You can add them
      to the budget like thisy
      <pre>
{
  "timings": {
    "headerTime": 800,
    "logoTime": 500
  }
}</pre>
        And they will be tested and matched against your configured value.
      </p>

  <h3>Using WebPageTest</h3>
  <p>If you are using WebPageTest, you can setup a budget matching almost whatever WPT fetches but the most useable
    things are testing the number of requests, size, TTFB and the speed index score. To test all these four things,
    you add a JSON file looking like this:
    <pre>
{
  "wpt" : {
    "requests": 60,
    "TTFB": 200,
    "bytesIn": 1000000,
    "SpeedIndex" : 1000
  }
}</pre>
    And change the values to what you want to test. In this example the budget will blow if we have more that 60 requests on a page,
    a time to first byte larger than 200 ms, a page weight more than 1000 kb and a speed index score larger than 1000.
  </p>

</div>

<div class="section">
      <div class="page-header">
      <h2 id="feature" style="word-wrap: break-word;">Create a new feature/improvement request</h2>
    </div>
    <p>
      If you have ideas of how sitespeed.io can be improved or if you have any features that you think is missing, please add it to the <a href="https://github.com/sitespeedio/sitespeed.io/issues?labels=&amp;milestone=&amp;page=1&amp;state=open" >issue list</a>.
    </p>

    </div>


<div class="section">

      <div class="page-header">
      <h2 id="developers">Developers</h2>
    </div>
    <p style="word-wrap: break-word;">
    You can fork the project at <a href="https://github.com/sitespeedio/sitespeed.io" >https://github.com/sitespeedio/sitespeed.io</a> and create
    your own version or contribute to the existing one.
    The master branch is the latest release and/or in production-ready state.
    Clone that and you know it will always work.
    </p>

    </div>

<div class="section">
      <div class="page-header">
      <h2 id="postTasks">Add your own post tasks</h2>
    </div>
    <p>When sitespeed.io collected all the metrics, you have the possibility to add your own post tasks,
      meaning writing your own NodeJS code to take all the metrics and do whatever you want with it (store it to a database etc).
      </p>
      <p>
        You add your own post task (you can have multiple) in an directory and feed the directory name and path to sitespeed, like this:
<pre class="bash">
$ sitespeed.io -u http://www.sitespeed.io --postTasksDir myPostTaskDir
</pre>
      </p>
      <p>
        In that directory, create a file and follow the following standard:
<pre>
exports.task = function(result, config, cb) {
  console.log('yep this is my task running!')
  cb();
};
</pre>
The task will be called with the following:
<ul>
  <li>
    <strong>result</strong> - a JSON that contains all the metrics collected. Print it out to see exactly how it is constructed
  </li>
  <li>
    <strong>config</strong> -  the sitespeed.io configuration object, contains info about the run and where to store the data
  </li>
  <li>
    <strong>cb</strong> - the callback to call when you are finished.
  </li>
</ul>
       All post tasks runs in parallell.
      </p>

    </div>

    <div class="section" id="addrule">
      <div class="page-header">
        <h2>Add your own rules</h2>
      </div>
      <p style="word-wrap: break-word;">
        Sitspeed uses <a href="http://yslow.org/" >YSlow</a> as the engine for creating and managing the rules that decides how good the web page is optimized for performance.  <a href="https://twitter.com/stoyanstefanov" >Stoyan Stefanov</a> has written three good blog posts of how you develop and write rules for YSlow:
      </p>
      <ul>
        <li><a href="http://www.phpied.com/yslow-development-getting-started/" >Getting started</a></li>
        <li><a href="http://www.phpied.com/yslow-development-setup/" >Setup</a></li>
        <li><a href="http://www.phpied.com/yslow-development-custom-rulesets/" >Custom ruleset</a></li>
      </ul>

      <p>
        To do it for sitespeed, this is what you need:
      </p>
      <ol>
        <li><p>Clone the project:
          <pre>git clone git@github.com:sitespeedio/yslow.git</pre>
        </p>
      </li>
      <li><p style="word-wrap: break-word;">There are two files that you need to change, first the rule file, where you add your own rule:
        <a href="https://github.com/sitespeedio/yslow/blob/master/src/common/rulesets/ruleset_sitespeed.js" >https://github.com/sitespeedio/yslow/blob/master/src/common/rulesets/ruleset_sitespeed.js</a>. </p>

        <p>You need to do two changes: Add your rule <i>YSLOW.registerRule(...)</i> and register your rule to the ruleset <i>YSLOW.registerRuleset(...)</i></p>
        <p>In this example, I will add a rule called <b>cssprint</b> that will check for css files used only for printing the page:</p>
        <pre class="prettyprint">
YSLOW.registerRule({
  id: 'cssprint',
  name: 'Do not load print stylesheets, use @media type print instead',
  info: 'Loading a specific stylesheet for printing slows down the page, ' +
  'even though it is not used',
  category: ['css'],
  config: {points: 20},
  url: 'http://sitespeed.io/rules/#cssprint',
  lint: function (doc, cset, config) {
    var i, media, score,url,
    offenders = [],
    hash = {},
    comps = cset.getComponentsByType('css'),
    links = doc.getElementsByTagName('link');

    for (i = 0, len = links.length; i &lt; len; i += 1) {
      if (links[i].media === 'print') {
        url = links[i].href;
        hash[url] = 1;
      }
    }

    for (var i = 0; i &lt; comps.length; i++) {
      if (hash[comps[i].url]) {
        offenders.push(comps[i]);
      }
    }

    score = 100 - offenders.length * parseInt(config.points, 20);

    return {
      score: score,
      message: (offenders.length > 0) ? YSLOW.util.plural(
        'There %are% %num% print css files included on the page, that should be @media query instead',
        offenders.length
        ) : '',
      components: offenders
      };
    }
});</pre>

        <p>When you have written your rule, register it to the ruleset and give it a proper weight (the lines with <b>cssprint</b> are the new ones, the rest exists already):</p>

        <pre>
YSLOW.registerRuleset({
  id: 'sitespeed.io-X.Y',
  name: 'Sitespeed.io rules vX.Y',
  rules: {
    ...
    cssprint: {},
    ...
    weights: {
      ...
      cssprint: 3,
      ...</pre>
</li>

            <li><p style="word-wrap: break-word;">The next step is adding the documentation for the rule, you do that in the file: <a href="https://github.com/soulgalore/yslow/blob/master/src/common/doc.js" >https://github.com/soulgalore/yslow/blob/master/src/common/doc.js</a>.</p> <p>You add one row where you put in the rule info:
              <pre>YSLOW.doc.addRuleInfo('rulename','title','description')</pre>

              For the <b>cssprint</b> rule, it looks like this:
              <pre>YSLOW.doc.addRuleInfo('cssprint','Avoid loading specific css for print','Loading a specific stylesheet for print, can block rendering in your browser (depending on browser version) and will for almost all browsers, block the onload event to fire (even though the print stylesheet is not even used!).');
              </pre>

              It is used when you run sitespeed to create the rule definition HTML file that is put into the results, so you always can backtrack which rules you use. </p>
            </li>
            <li>Create the new YSlow javascript file: <pre>make phantomjs</pre></li>
            <li>Test that it works on one url (standing in root for YSlow): <pre>phantomjs build/phantomjs/yslow.js d -r sitespeed.io-desktop -f xml http://yoururl.com</pre></li>
            <li>Move the newly created rulefile into your dependencies directory for sitespeed, on my local I do it this way:
              <pre>cp build/phantomjs/yslow.js /tmp/myYslow.js</pre>
            </li>
            <li>Run sitespeed in your folder: <pre>sitespeed.io -u http://yoururl.com -y /tmp/myYslow.js</pre></li>
          </ol>
</div>


<div class="section">
    <div class="page-header">
      <h2 id="dependencies" style="word-wrap: break-word;">Dependencies</h2>
    </div>
      <p>
        Here are the dependencies for running sitespeed.io:
      </p>
      <dl class="dl-horizontal">
        <dt>NodeJS</dt>
        <dd>You need to have NodeJS installed to be able to run sitespeed.io</dd>

      <dt>Java 1.6</dt>
      <dd>You need to have Java 1.6 (or higher) installed because the Crawler and Selenium (who drives the browsers) uses Java.</dd>

        </dl>
</div>

<div class="section">
      <div class="page-header">
      <h2 id="components">Components</h2>
</div>

      <p>The following components are used by sitespeed.io:</p>
      <dl class="dl-horizontal">
      <dt>PhantomJS</dt>
      <dd>The headless WebKit <a href="http://phantomjs.org/">browser</a> by Ariya Hidayat.</dd>
      <dt>Handlebars</dt>
      <dd><a href="http://handlebarsjs.com/">The Javascript template system</a>.</dd>
      <dt>FastStats</dt>
      <dd>A <a href="https://github.com/bluesmoon/node-faststats">NodeJS library</a> to do statistical analysis of numeric datasets by Philip Tellis.</dd>
      <dt>gpagespeed</dt>
      <dd>Analyze your web page using <a href="https://www.npmjs.org/package/gpagespeed">Google Page Speed</a> by Geir Gsodden.</dd>
      <dt>YSlow</dt>
      <dd>Sitespeed.io uses the rule engine of <a href="http://yslow.org" >YSlow</a>, because it is great! YSlow was originally developed by Yahoo and now maintained by <strong>Marcel Duran</strong>, a rule engine & browser plugin created to test your web page against <a href="http://yslow.org/#web_performance_best_practices_and_rules" >best practices rules</a>. The version used is the <a href="https://github.com/marcelduran/yslow/wiki/PhantomJS" >YSlow/PhantomJs</a> version. Sitespeed uses it own ruleset of best practice performance rules, and the code can be found  <a href="https://github.com/soulgalore/yslow/blob/master/src/common/rulesets/ruleset_sitespeed.js" >here</a>.</dd>
      <dt>Bootstrap</dt>
      <dd><a href="http://getbootstrap.com/" >Bootstrap</a> is a front end framework to create nice looking HTML, all the front end of the result pages produced by sitespeed are built with Bootstrap.</dd>
      <dt>Crawler</dt>
      <dd>This is a simple  <a href="https://github.com/soulgalore/crawler" >Java crawler</a> that output all links within a domain to a file, it can follow a specific path or make sure urls containing X not will be fetched. In the backend it uses Java:s best HTTP framework: <a href="http://hc.apache.org/" >HttpComponents</a> that makes sure it can do whatever you want.</dd>
      <dt>Stupid Table Plugin</dt>
      <dd><a href="https://github.com/joequery/Stupid-Table-Plugin" >Stupid Table Plugin</a> by Joseph McCullough is a really small table column sorter.</dd>
      <dt>BrowserTime</dt>
      <dd><a href="https://github.com/tobli/browsertime">BrowserTime</a> collects browser timings using the Navigation Timing API.</dd>
      <dt>WPT-wrapper</dt>
      <dd><a href="https://www.npmjs.org/package/webpagetest">WebPageTest API wrapper</a> for NodeJS by Marcel Duran.</dd>
      <dt>BrowserMobProxy</dt>
      <dd>To collect the HAR files we use the <a href="https://github.com/lightbody/browsermob-proxy">BrowserMobProxy</a>. We would love to move to a NodeJS proxy (BMP is Java)!</dd>
      </dl>

</div>



<div class="section">
      <div class="page-header">
      <h2 id="feature-2" style="word-wrap: break-word;">Create a new feature/improvement request</h2>
    </div>
    <p>
      If you have ideas of how sitespeed.io can be improved or if you have any features that you think is missing, please add it to the <a href="https://github.com/sitespeedio/sitespeed.io/issues?labels=&amp;milestone=&amp;page=1&amp;state=open" >issue list</a>.
    </p>

    </div>


<div class="section">
      <div class="page-header">
      <h2 id="bug">Report a bug</h2>
    </div>
    <p style="word-wrap: break-word;">
     If you find a bug, go through the current known bug list <a href="https://github.com/sitespeedio/sitespeed.io/issues?labels=bug&amp;state=open">https://github.com/sitespeedio/sitespeed.io/issues?labels=bug&amp;state=open</a>. If it doesn't exist there, please add it!
    </p>

    </div>

</div>
</div>
